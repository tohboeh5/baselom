min_version = "2025.11.3"

[env]
_.python.venv = { path = ".venv" }

[tools]
python = "3.12"
uv = "0.9.8"
rust = "1.83.0"

[tasks.install]
run = "uv sync && (rustup component add clippy rustfmt || true) && (rustup target add wasm32-unknown-unknown || true)"

# Python build tasks (v0.1.0)
[tasks.build]
run = "uv run maturin develop --features python"

[tasks.build-release]
run = "uv run maturin develop --release --features python"

# WASM build tasks (v0.2.0+)
[tasks.build-wasm]
run = "cargo build --target wasm32-unknown-unknown --features wasm --release"

[tasks.build-wasm-dev]
run = "cargo build --target wasm32-unknown-unknown --features wasm"

# Testing - Individual test tasks
[tasks.test-rust]
description = "Run Rust unit tests"
run = "cargo test"

[tasks.test-python]
description = "Run Python tests"
run = "uv run pytest"

[tasks.test-wasm]
description = "Build and check WASM target compiles (tests not yet supported)"
run = "cargo check --features wasm --target wasm32-unknown-unknown"

# Testing - Combined tasks (like dev task pattern)
[tasks.test]
description = "Run all tests (Rust + Python)"
depends = ["test-rust", "test-python"]

[tasks.test-all]
description = "Run all tests including WASM check"
depends = ["test-rust", "test-python", "test-wasm"]

# Linting and formatting
[tasks.lint]
run = "cargo fmt --check && cargo clippy -- -D warnings && uv run ruff check ."

[tasks.format]
run = "cargo fmt && uv run ruff format ."

[tasks.typecheck]
run = "uv run mypy baselom_core"

# Check that code compiles for all targets
[tasks.check-all]
run = "cargo check && cargo check --features python && cargo check --features wasm --target wasm32-unknown-unknown"

# Development workflow
[tasks.dev]
description = "Build and run all checks for development"
depends = ["build", "lint", "test"]
